#Open Babel top-level Makefile

srcdir        = @srcdir@
VPATH         = @srcdir@
top_srcdir    = @top_srcdir@

DEST	      = @bindir@

INSTALL	      = @INSTALL_PROGRAM@

SUBDIRS	      = src test
DISTDIR       = $(top_srcdir)/../openbabel

all:
		@for i in $(SUBDIRS); do \
			(cd $$i; $(MAKE) $(MFLAGS) all) \
			|| case "$(MFLAGS)" in *k*) fail=yes;; *) exit 1;; esac; \
		done && test -z "$$fail"

test:		check
check:
		@for i in $(SUBDIRS); do \
			(cd $$i; $(MAKE) $(MFLAGS) check) \
			|| case "$(MFLAGS)" in *k*) fail=yes;; *) exit 1;; esac; \
		done && test -z "$$fail"

clean:
		rm -f *~
		@for i in $(SUBDIRS); do \
			(cd $$i; $(MAKE) $(MFLAGS) clean) \
			|| case "$(MFLAGS)" in *k*) fail=yes;; *) exit 1;; esac; \
		done && test -z "$$fail"

distclean:
		rm -f config.cache config.status config.log config.h *~
		@for i in $(SUBDIRS); do \
			(cd $$i; $(MAKE) $(MFLAGS) distclean) \
			|| case "$(MFLAGS)" in *k*) fail=yes;; *) exit 1;; esac; \
		done && test -z "$$fail"
		rm -f Makefile stamp-h

install:	all
		$(INSTALL) $(PROGRAM) $(DEST)

dist:
	        rm -rf $(DISTDIR) openbabel.tar.gz
		mkdir $(DISTDIR)
		tar cf - $(top_srcdir) | (cd $(DISTDIR); tar xf -)
		(cd $(DISTDIR); $(MAKE) distclean)
		-for i in $(SUBDIRS); do \
			(cd $(DISTDIR)/$$i; rm -fr RCS CVS .#\*); \
		done && test -z "$$fail"
		(cd $(DISTDIR)/..; tar cvzf openbabel.tar.gz $(DIST))
		rm -rf $(DISTDIR)

# Update the Makefiles if things are updated
#$(srcdir)/configure:  configure.in
#		cd $(srcdir) && autoconf

# autoheader might not change config.h.in, so touch a stamp file.
${srcdir}/config.h.in:  stamp-h.in
${srcdir}/stamp.h.in:  configure.in aclocal.m4
		cd ${srcdir} && autoheader
		echo timestamp > ${srcdir}/stamp-h.in

config.h: stamp-h
stamp-h:  config.h.in config.status
		./config.status

Makefile:  Makefile.in config.status
		./config.status

config.status:  configure
		./config.status --recheck
